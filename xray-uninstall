#!/bin/bash

set -e

echo "[+] Stopping xray.service (if running)..."
systemctl stop xray.service 2>/dev/null || true
systemctl disable xray.service 2>/dev/null || true

echo "[+] Removing Xray binary..."
rm -f /usr/local/bin/xray

echo "[+] Removing config and keys..."
rm -rf /usr/local/etc/xray

echo "[+] Removing systemd service..."
rm -f /etc/systemd/system/xray.service
systemctl daemon-reload

echo "[+] Removing helper scripts (mainuser, userlist, newuser, rmuser, sharelink)..."
rm -f /usr/local/bin/mainuser \
      /usr/local/bin/userlist \
      /usr/local/bin/newuser \
      /usr/local/bin/rmuser \
      /usr/local/bin/sharelink \
      /usr/local/bin/xray-install

echo "[+] Removing help file..."
rm -f "$HOME/help"           # -f, чтобы не упасть, если файла нет


echo "[+] Optional: cleaning up unused packages (you can comment this out if needed)..."
apt remove --purge -y qrencode jq curl 2>/dev/null || true
apt autoremove -y 2>/dev/null || true

echo "[✓] Xray and all related files removed."
